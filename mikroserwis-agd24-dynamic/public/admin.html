<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Panel admina – Rezerwacje</title>
  <link rel="stylesheet" href="/css/main.css">
  <style>
    .login-box,.admin-box{max-width:960px;margin:24px auto;background:#0f2242;border:1px solid var(--line);border-radius:16px;padding:16px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--line);padding:8px;text-align:left}
    th{background:#102449}
    .login-box label{display:block;margin:8px 0}
    .login-box input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0e2348;color:#e9eefb}
  </style>
</head>
<body>
  <header class="site-header"><div class="container header-inner">
    <a class="logo" href="/" aria-label="Start"><span>Mikroserwis AGD24 – Admin</span></a>
    <nav class="site-nav"><ul><li><a href="/">Strona główna</a></li></ul></nav>
  </div></header>
  <main class="content">
    <section class="login-box" id="loginBox">
      <h1>Logowanie</h1>
      <form id="loginForm">
        <label>Login <input type="text" name="login" required></label>
        <label>Hasło <input type="password" name="password" required></label>
        <button class="btn btn-primary" type="submit">Zaloguj</button>
        <p id="loginStatus" class="muted"></p>
      </form>
    </section>
    <section class="admin-box" id="adminBox" hidden>
      <h1>Rezerwacje</h1>
      <table>
        <thead><tr><th>Data</th><th>Imię i nazwisko</th><th>Telefon</th><th>E-mail</th><th>Model</th><th>Opis</th><th>Dodano</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
    </section>
  </main>
  <script>
  (function(){
    const loginForm = document.getElementById('loginForm');
    const loginBox = document.getElementById('loginBox');
    const adminBox = document.getElementById('adminBox');
    const status = document.getElementById('loginStatus');
    const rows = document.getElementById('rows');

    async function fetchRes(){
      const r = await fetch('/api/reservations', {credentials:'include'});
      if(!r.ok) throw new Error('Brak dostępu');
      const data = await r.json();
      rows.innerHTML = data.map(x=>\`
        <tr>
          <td>\${x.date || '-'}</td>
          <td>\${x.name}</td>
          <td>\${x.phone}</td>
          <td>\${x.email}</td>
          <td>\${x.model}</td>
          <td>\${x.message}</td>
          <td>\${new Date(x.created_at).toLocaleString('pl-PL')}</td>
        </tr>\`).join('');
    }

    loginForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = Object.fromEntries(new FormData(loginForm).entries());
      const r = await fetch('/login', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload), credentials:'include'});
      if(r.ok){
        loginBox.hidden = true;
        adminBox.hidden = false;
        fetchRes().catch(()=>{ status.textContent='Nie udało się pobrać rezerwacji'; });
      }else{
        status.textContent = 'Zły login lub hasło';
      }
    });
  })();
  </script>
</body>
</html>
